<div *ngIf="loading" class="loading-spinner">
  <p>Loading...</p>
</div>

<div *ngIf="!loading" class="container">
  <h1 class="text-center" style="margin-bottom: 20px; margin-top: 10px;">
    Financial Report
  </h1>

  <!-- Period -->
  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center" 
         data-bs-toggle="collapse" data-bs-target="#periodCard" aria-expanded="true" 
         aria-controls="periodCard" style="cursor: pointer;">
      <h5 class="card-title mb-0">Report Period</h5>
    </div>
    <div id="periodCard" class="collapse show">
      <div class="card-body">
        <p><strong>Start Date:</strong> {{ report.period.startDate }}</p>
        <p><strong>End Date:</strong> {{ report.period.endDate }}</p>
      </div>
    </div>
  </div>

  <!-- Transaction Summary -->
  <div class="card" *ngIf="report.transactionSummary">
    <div class="card-header d-flex justify-content-between align-items-center" 
         data-bs-toggle="collapse" data-bs-target="#transactionSummaryCard" aria-expanded="true" 
         aria-controls="transactionSummaryCard" 
         style="cursor: pointer; background: linear-gradient(to right, #28a745, #22c548);">
      <h5 class="card-title mb-0">Transaction Summary</h5>
    </div>
    <div id="transactionSummaryCard" class="collapse show">
      <div class="card-body d-flex align-items-center justify-content-between">
        <div>
          <p><strong>Total Income:</strong> ${{ report.transactionSummary.totalIncome }}</p>
          <p><strong>Total Expenses:</strong> ${{ report.transactionSummary.totalExpenses }}</p>
          <p><strong>Net Savings:</strong> ${{ report.transactionSummary.netSavings }}</p>
        </div>
        <!-- Canvas always in DOM -->
        <canvas #spendingChart style="max-width: 600px; height: 300px;"></canvas>
      </div>
    </div>
  </div>

  <!-- Spending by Date Chart -->
  <div class="card" *ngIf="report.transactionSummary?.spendingByDate">
    <div class="card-header d-flex justify-content-between align-items-center" 
         data-bs-toggle="collapse" data-bs-target="#spendingDateCard" aria-expanded="true" 
         aria-controls="spendingDateCard" style="cursor: pointer;">
      <h5 class="card-title mb-0">Spending By Date</h5>
    </div>
    <div id="spendingDateCard" class="collapse show">
      <div class="card-body">
        <!-- Canvas always in DOM -->
        <canvas #spendingDateChart></canvas>
      </div>
    </div>
  </div>

  <!-- Investment Performance -->
  <div class="card" *ngIf="report.investmentPerformance">
    <div class="card-header d-flex justify-content-between align-items-center" 
         data-bs-toggle="collapse" data-bs-target="#investmentPerformanceCard" aria-expanded="true" 
         aria-controls="investmentPerformanceCard" style="cursor: pointer;">
      <h5 class="card-title mb-0">Investment Performance</h5>
    </div>
    <div id="investmentPerformanceCard" class="collapse show">
      <div class="card-body">
        <p><strong>Total Profit/Loss:</strong> ${{ report.investmentPerformance.totalProfitLoss }}</p>
        <ul>
          <li *ngFor="let investment of report.investmentPerformance.details">
            {{ investment.name }} ({{ investment.type }}): ${{ investment.profitLoss }}
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Savings Goals -->
  <div class="card" *ngIf="report.savingsGoals">
    <div class="card-header d-flex justify-content-between align-items-center" 
         data-bs-toggle="collapse" data-bs-target="#savingsGoalsCard" aria-expanded="true" 
         aria-controls="savingsGoalsCard" style="cursor: pointer;">
      <h5 class="card-title mb-0">Savings Goals</h5>
    </div>
    <div id="savingsGoalsCard" class="collapse show">
      <div class="card-body">
        <h6 *ngIf="report.savingsGoals.achieved">Achieved Goals</h6>
        <ul *ngIf="report.savingsGoals.achieved">
          <li *ngFor="let goal of report.savingsGoals.achieved">
            {{ goal.goalName }}: ${{ goal.currentAmount }} / ${{ goal.targetAmount }}
          </li>
        </ul>

        <h6 *ngIf="report.savingsGoals.failed">Failed Goals</h6>
        <ul *ngIf="report.savingsGoals.failed">
          <li *ngFor="let goal of report.savingsGoals.failed">
            {{ goal.goalName }}: ${{ goal.currentAmount }} / ${{ goal.targetAmount }}
          </li>
        </ul>

        <h6 *ngIf="report.savingsGoals.ongoing">Ongoing Goals</h6>
        <ul *ngIf="report.savingsGoals.ongoing">
          <li *ngFor="let goal of report.savingsGoals.ongoing">
            {{ goal.goalName }}: ${{ goal.currentAmount }} / ${{ goal.targetAmount }}
            ({{ goal.progress }})
          </li>
        </ul>
      </div>
    </div>
  </div>
  <app-footer [showFullFooter]="false"></app-footer>
</div>